generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String     @id @default(cuid())
  name           String
  email          String     @unique
  hashedPassword String
  role           String     @default("VIEWER")
  status         String     @default("ACTIVE")
  phone          String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  flightsAsPilot  Flight[]   @relation("FlightPilot")
  flightsAsPayer  Flight[]   @relation("FlightPayer")
  flightsAsUsedBy Flight[]   @relation("FlightUsedBy")
  expenses        Expense[]
  sessions        Session[]
}

model Aircraft {
  id              String   @id @default(cuid())
  tailNumber      String   @unique
  model           String
  manufacturer    String?
  year            Int?
  status          String?  @default("AVAILABLE")
  totalHours      Decimal? @default(0)
  nextMaintenance DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  flights Flight[]
}

model Flight {
  id                  String    @id @default(cuid())
  flightDate          DateTime
  origin              String
  destination         String
  distanceNm          Decimal?
  fuelStart           Decimal?
  fuelEnd             Decimal?
  durationHours       Decimal?
  baseAbsorption      String?
  baseFixedAbsorption String?
  baseTax             Decimal?
  travelExpenses      Decimal?  @default(0)
  maintenanceExpenses Decimal?  @default(0)
  totalCost           Decimal?  @default(0)
  notes               String?
  attachment          String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  pilotId    String?
  payerId    String?
  aircraftId String?
  usedById   String?

  pilot    User?     @relation("FlightPilot", fields: [pilotId], references: [id])
  payer    User?     @relation("FlightPayer", fields: [payerId], references: [id])
  usedBy   User?     @relation("FlightUsedBy", fields: [usedById], references: [id])
  aircraft Aircraft? @relation(fields: [aircraftId], references: [id])

  expenses Expense[]
}

model Expense {
  id          String   @id @default(cuid())
  expenseDate DateTime
  category    String
  amount      Decimal
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  paidById String?
  flightId String?

  paidBy User?   @relation(fields: [paidById], references: [id])
  flight Flight? @relation(fields: [flightId], references: [id])
}

model DemoRequest {
  id            String   @id @default(cuid())
  name          String
  email         String
  phone         String?
  company       String?
  preferredDate DateTime?
  message       String?
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  ip        String?
  userAgent String?
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
